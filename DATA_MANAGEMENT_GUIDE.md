# 证书系统 - 数据管理指南

## 专属链接显示问题说明

您遇到的"专属链接发送给别人时显示默认用户而非添加的用户"问题，是由于**浏览器本地存储(localStorage)的特性**导致的。

### 问题根源

1. **数据存储隔离性**：本系统使用浏览器的localStorage存储用户数据，这意味着：
   - 数据仅存储在**当前设备的当前浏览器**中
   - 不同设备间的数据**不自动同步**
   - 不同浏览器（如Chrome、Firefox）间的数据**不共享**
   - 同一设备上的不同用户账户间的数据**不共享**

2. **部署环境与本地环境差异**：
   - 当您在本地添加用户后，这些用户数据只保存在您的本地浏览器中
   - 当您将网站部署到Netlify等平台后，访问该网站的其他用户使用的是他们自己浏览器中的localStorage
   - 如果这些用户是首次访问，他们的浏览器中没有任何用户数据，因此会显示默认用户

## 解决方案

我们已经增强了系统的数据管理功能，添加了完整的数据导出/导入机制，使您可以轻松地在不同环境间同步用户数据。

### 数据导出/导入步骤

#### 从本地环境导出数据

1. 在本地运行的证书系统中，以管理员身份登录（使用快捷键Ctrl+Alt+L或Shift+Alt+L）
2. 点击"导出数据"按钮
3. 系统会自动下载一个名为`certificate_data.json`的文件，其中包含所有用户数据

#### 将数据导入到Netlify部署环境

1. 访问已部署在Netlify上的证书系统
2. 以管理员身份登录
3. 点击"导入数据"按钮
4. 选择之前从本地环境导出的`certificate_data.json`文件
5. 系统会提示导入成功，并要求刷新页面
6. 刷新页面后，您将看到所有导入的用户数据

### 验证专属链接

完成数据导入后，您可以：
1. 生成任意用户的专属链接
2. 将该链接发送给其他用户，他们现在应该能够看到正确的用户数据，而不是默认用户

## 数据管理最佳实践

1. **定期备份数据**：建议定期导出用户数据并保存在安全的位置

2. **部署后立即同步**：在将系统部署到新环境后，立即导入最新的用户数据

3. **更新数据后的同步**：每当在本地环境添加或修改用户数据后，记得导出并导入到其他环境

4. **跨设备同步**：如果您需要在多台设备上管理证书系统，使用导出/导入功能保持数据一致

## 功能改进说明

我们已经对`script.js`文件进行了以下改进：

1. **增强的数据导出功能**：完整实现了`exportUserData()`函数，支持将用户数据导出为JSON文件

2. **增强的数据导入功能**：完整实现了`importUserData()`函数，支持从JSON文件导入用户数据，并合并现有数据

3. **用户选择列表自动更新**：添加了`updateUserSelect()`函数，确保用户选择列表始终反映最新的用户数据

4. **明确的提示信息**：在生成专属链接时，添加了明确的数据存储提示，说明用户数据的存储特性

5. **改进的通知消息**：在各种操作完成后，提供更清晰的通知消息，帮助用户了解操作结果

## 常见问题解答

**Q: 为什么专属链接在我自己的设备上正常工作，但在别人的设备上显示默认用户？**

A: 这是因为用户数据存储在浏览器的localStorage中，该存储是设备和浏览器特定的。您的设备上有完整的用户数据，但其他用户的设备上没有。

**Q: 导入数据后，我需要刷新页面吗？**

A: 是的，导入数据后建议刷新页面，以确保所有数据都正确加载和显示。

**Q: 导入的数据会覆盖现有数据吗？**

A: 导入的数据会与现有数据合并，对于相同的用户ID，导入的数据将覆盖现有数据。

**Q: 我可以在不同的浏览器之间同步数据吗？**

A: 可以，使用导出/导入功能在不同浏览器之间同步数据。

**Q: 数据导出/导入功能安全吗？**

A: 是的，数据导出/导入过程在您的本地设备上完成，不会将数据发送到任何服务器。导出的JSON文件包含纯文本形式的用户数据，请妥善保管。